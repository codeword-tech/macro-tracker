var tinybirdTrackerJs=function(){var e=function(e){var n=e.localStorage,t=e.document.currentScript;if(e&&t){var r=(p("api")||new URL(t.src).origin)+"/v0/datasources",o=p("source"),i=p("token");if(!o)throw new Error("'dataSource' name is required to start sending events");if(!i)throw new Error("'token' is required to start sending events");var s=function(e){for(var n=document.cookie.split(";"),t=0;t<n.length;++t){for(var r=n[t];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf("tinybird="))return r.substring("tinybird=".length,r.length)}return null}(),u=JSON.parse(n.getItem("tinybird_events")||"[]"),a=l(),c=!1;s||(s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0;return("x"==e?n:3&n|8).toString(16)}),document.cookie="tinybird="+(s||"")+"; path=/"),e.addEventListener("beforeunload",x),e.addEventListener("unload",x,!1),e.tinybird=function(e,n){var t=n||{};t.event=e||"",t.date=l(),t.session=a,t.uuid=s,u.push(t),"pageload"===e&&d(5)},f(2e3,5)}function d(e){if(!c)if(u.length>0){c=!0;var t=r+"?format=ndjson&mode=append&name="+o+"&token="+i,s=new FormData;s.append("ndjson",function(e){return e.map(e=>JSON.stringify(e)).join("\n")+"\n"}(u)),function(e,n){return n=n||{},new Promise(function(t,r){var o=new XMLHttpRequest,i=[],s=[],u={},a=function(){return{ok:2==(o.status/100|0),statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(JSON.parse(o.responseText))},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:a,headers:{keys:function(){return i},entries:function(){return s},get:function(e){return u[e.toLowerCase()]},has:function(e){return e.toLowerCase()in u}}}};for(var c in o.open(n.method||"get",e,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,n,t){i.push(n=n.toLowerCase()),s.push([n,t]),u[n]=u[n]?u[n]+","+t:t}),t(a())},o.onerror=r,o.withCredentials="include"==n.credentials,n.headers)o.setRequestHeader(c,n.headers[c]);o.send(n.body||null)})}(t,{method:"POST",body:s}).then(function(e){return e.json()}).then(function(e){e?(u=[],n.setItem("tinybird_events","[]"),f(2e3,5)):a(),c=!1}).catch(function(){a()})}else f(2e3,5);function a(){e>0&&(c=!1,f(2e3,e-1))}}function f(e,n){setTimeout(function(){d(n)},e)}function x(){n.setItem("tinybird_events",JSON.stringify(u)),d()}function l(e){return(e=e||new Date).toISOString().replace("T"," ").split(".")[0]}function p(e){return t.getAttribute("data-"+e)}};return e(window),e}();
//# sourceMappingURL=tinybird-tracker.js.map
