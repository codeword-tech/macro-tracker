var tinybirdTrackerJs=function(){var e=function(e){var t=e.document,n=e.localStorage;if(e&&e.document&&e.document.currentScript){var r=(w("api")||new URL(t.currentScript.src).origin)+"/v0/events",o=w("source"),i=w("token");if(!o)throw new Error("'dataSource' name is required to start sending events");if(!i)throw new Error("'token' is required to start sending events");var s="tinybird_events",u=5e3,a=function(t){for(var n="tinybird=",r=e.document.cookie.split(";"),o=0;o<r.length;++o){for(var i=r[o];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(n))return i.substring(n.length,i.length)}return null}(),c=JSON.parse(n.getItem(s)||"[]"),d=b(),f=!1;a||(a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),e.document.cookie="tinybird="+(a||"")+"; path=/"),e.addEventListener("beforeunload",g),e.addEventListener("unload",g,!1);var x=e.tinybird||[];e.tinybird=v;for(var l=0;l<x.length;l++)v.apply(this,x[l]);p(u,5)}function h(e){function t(){e>0&&(f=!1,p(u,e-1))}f||(c.length>0?(f=!0,function(e,t){return t=t||{},new Promise(function(n,r){var o=new XMLHttpRequest,i=[],s=[],u={},a=function(){return{ok:2==(o.status/100|0),statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:a,headers:{keys:function(){return i},entries:function(){return s},get:function(e){return u[e.toLowerCase()]},has:function(e){return e.toLowerCase()in u}}}};for(var c in o.open(t.method||"get",e,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,t,n){i.push(t=t.toLowerCase()),s.push([t,n]),u[t]=u[t]?u[t]+","+n:n}),n(a())},o.onerror=r,o.withCredentials="include"==t.credentials,t.headers)o.setRequestHeader(c,t.headers[c]);o.send(t.body||null)})}(r+"?name="+o+"&token="+i,{method:"POST",body:m(c)}).then(function(e){return e.json()}).then(function(e){e?(c=[],n.setItem(s,"[]"),p(u,5)):t(),f=!1}).catch(function(e){t()})):p(u,5))}function p(e,t){setTimeout(function(){h(t)},e)}function v(e,t){var n=t||{};n.event=e||"",n.timestamp=b(),n.session_start=d,n.uuid=a,c.push(n)}function g(){n.setItem(s,JSON.stringify(c)),h()}function m(e){return e.map(e=>JSON.stringify(e)).join("\n")}function b(e){return(e=e||new Date).toISOString().replace("T"," ").split(".")[0]}function w(e){return t.currentScript.getAttribute("data-"+e)}};return e(window),e}();
//# sourceMappingURL=tinybird-tracker.js.map
