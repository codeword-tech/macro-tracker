var tinybirdTrackerJs=function(){var e=function(e){var n=e.document,t=e.localStorage;if(e&&e.document&&e.document.currentScript){var r=(w("api")||new URL(n.currentScript.src).origin)+"/v0/events",o=w("source"),i=w("token");if(!o)throw new Error("'dataSource' name is required to start sending events");if(!i)throw new Error("'token' is required to start sending events");var s="tinybird_events",u=5e3,a=function(n){for(var t="tinybird=",r=e.document.cookie.split(";"),o=0;o<r.length;++o){for(var i=r[o];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null}(),c=JSON.parse(t.getItem(s)||"[]"),d=m(),f=!1;a||(a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0;return("x"==e?n:3&n|8).toString(16)}),e.document.cookie="tinybird="+(a||"")+"; path=/"),e.addEventListener("beforeunload",g),e.addEventListener("unload",g,!1);var x=e.tinybird||[];e.tinybird=v;for(var l=0;l<x.length;l++)v.apply(this,x[l]);h(u,5)}function p(e){if(!f)if(c.length>0){f=!0;var n=r+"?name="+o+"&token="+i,a=new FormData;a.append("ndjson",function(e){return e.map(e=>JSON.stringify(e)).join("\n")+"\n"}(c)),function(e,n){return n=n||{},new Promise(function(t,r){var o=new XMLHttpRequest,i=[],s=[],u={},a=function(){return{ok:2==(o.status/100|0),statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:a,headers:{keys:function(){return i},entries:function(){return s},get:function(e){return u[e.toLowerCase()]},has:function(e){return e.toLowerCase()in u}}}};for(var c in o.open(n.method||"get",e,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,n,t){i.push(n=n.toLowerCase()),s.push([n,t]),u[n]=u[n]?u[n]+","+t:t}),t(a())},o.onerror=r,o.withCredentials="include"==n.credentials,n.headers)o.setRequestHeader(c,n.headers[c]);o.send(n.body||null)})}(n,{method:"POST",body:a}).then(function(e){return e.json()}).then(function(e){e?(c=[],t.setItem(s,"[]"),h(u,5)):d(),f=!1}).catch(function(e){d()})}else h(u,5);function d(){e>0&&(f=!1,h(u,e-1))}}function h(e,n){setTimeout(function(){p(n)},e)}function v(e,n){var t=n||{};t.event=e||"",t.timestamp=m(),t.session_start=d,t.uuid=a,c.push(t)}function g(){t.setItem(s,JSON.stringify(c)),p()}function m(e){return(e=e||new Date).toISOString().replace("T"," ").split(".")[0]}function w(e){return n.currentScript.getAttribute("data-"+e)}};return e(window),e}();
//# sourceMappingURL=tinybird-tracker.js.map
