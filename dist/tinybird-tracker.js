var tinybirdTrackerJs=function(){var e=function(e){var n=e.localStorage,t=e.document.currentScript;if(e&&t){var r=(g("api")||new URL(t.src).origin)+"/v0/datasources",o=g("source"),i=g("token");if(!o)throw new Error("'dataSource' name is required to start sending events");if(!i)throw new Error("'token' is required to start sending events");var s="tinybird_events",u=2e3,a=function(e){for(var n="tinybird=",t=document.cookie.split(";"),r=0;r<t.length;++r){for(var o=t[r];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(n))return o.substring(n.length,o.length)}return null}(),c=JSON.parse(n.getItem(s)||"[]"),d=h(),f=!1;a||(a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0;return("x"==e?n:3&n|8).toString(16)}),document.cookie="tinybird="+(a||"")+"; path=/"),e.addEventListener("beforeunload",p),e.addEventListener("unload",p,!1),e.tinybird=function(e,n){var t=n||{};t.event=e||"",t.date=h(),t.session=d,t.uuid=a,c.push(t),"pageload"===e&&x(5)},l(u,5)}function x(e){if(!f)if(c.length>0){f=!0;var t=r+"?format=ndjson&mode=append&name="+o+"&token="+i,a=new FormData;a.append("ndjson",function(e){return e.map(e=>JSON.stringify(e)).join("\n")+"\n"}(c)),function(e,n){return n=n||{},new Promise(function(t,r){var o=new XMLHttpRequest,i=[],s=[],u={},a=function(){return{ok:2==(o.status/100|0),statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:a,headers:{keys:function(){return i},entries:function(){return s},get:function(e){return u[e.toLowerCase()]},has:function(e){return e.toLowerCase()in u}}}};for(var c in o.open(n.method||"get",e,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,n,t){i.push(n=n.toLowerCase()),s.push([n,t]),u[n]=u[n]?u[n]+","+t:t}),t(a())},o.onerror=r,o.withCredentials="include"==n.credentials,n.headers)o.setRequestHeader(c,n.headers[c]);o.send(n.body||null)})}(t,{method:"POST",body:a}).then(function(e){return e.json()}).then(function(e){e?(c=[],n.setItem(s,"[]"),l(u,5)):d(),f=!1}).catch(function(){d()})}else l(u,5);function d(){e>0&&(f=!1,l(u,e-1))}}function l(e,n){setTimeout(function(){x(n)},e)}function p(){n.setItem(s,JSON.stringify(c)),x()}function h(e){return(e=e||new Date).toISOString().replace("T"," ").split(".")[0]}function g(e){return t.getAttribute("data-"+e)}};return e(window),e}();
//# sourceMappingURL=tinybird-tracker.js.map
