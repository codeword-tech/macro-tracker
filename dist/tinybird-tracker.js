var tinybirdTrackerJs=function(){var t=function(t){var e=t.document,n=t.localStorage;if(t&&t.document&&t.document.currentScript){var r=(M("api")||"https://api.tinybird.co")+"/v0/events",i=M("source"),o=M("token"),s=M("cookie-domain")||t.location.hostname,u=M("function")||"tinybird";if(!i)throw new Error("'dataSource' name is required to start sending events");if(!o)throw new Error("'token' is required to start sending events");var a,c,d="tinybird",f="tinybird_events",l="tinybird_last_activity",x=5e3,v=E(d),g=JSON.parse(n.getItem(f)||"[]"),h="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}),m=L(),p=!1;if(v){var b=function(t){if(t){var e=t.split(":");if(2===e.length)return{id:e[0],sessionStart:parseInt(e[1],10)}}return null}(E(d));b?(h=b.id,m=b.sessionStart):N(d,J(h,m))}else N(d,J(h,m));void 0!==e.hidden?(a="hidden",c="visibilitychange"):void 0!==e.msHidden?(a="msHidden",c="msvisibilitychange"):void 0!==e.webkitHidden&&(a="webkitHidden",c="webkitvisibilitychange"),t.addEventListener("beforeunload",O),t.addEventListener("unload",O,!1),e.addEventListener(c,function(){e[a]||U()},!1),U();var y=t[u]||[];t[u]=C;for(var S=0;S<y.length;S++)C.apply(this,y[S]);T(x,5)}function w(t){function e(){t>0&&(p=!1,T(x,t-1))}p||(g.length>0?(p=!0,function(t,e){return e=e||{},new Promise(function(n,r){var i=new XMLHttpRequest,o=[],s=[],u={},a=function(){return{ok:2==(i.status/100|0),statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(i.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:a,headers:{keys:function(){return o},entries:function(){return s},get:function(t){return u[t.toLowerCase()]},has:function(t){return t.toLowerCase()in u}}}};for(var c in i.open(e.method||"get",t,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(t,e,n){o.push(e=e.toLowerCase()),s.push([e,n]),u[e]=u[e]?u[e]+","+n:n}),n(a())},i.onerror=r,i.withCredentials="include"==e.credentials,e.headers)i.setRequestHeader(c,e.headers[c]);i.send(e.body||null)})}(r+"?name="+i+"&token="+o,{method:"POST",body:H(g)}).then(function(t){return t.json()}).then(function(t){t?(g=[],n.setItem(f,JSON.stringify([])),T(x,5)):e(),p=!1}).catch(function(t){e()})):T(x,5))}function T(t,e){setTimeout(function(){w(e)},t)}function k(){n.setItem(l,JSON.stringify(L()))}function C(t,e,n){var r=L(),i=e||{};i.event=t||"",i.timestamp=I(r),i.session_start=I(m),i.uuid=!n||n&&!0!==n?h:"",g.push(i),k()}function O(){n.setItem(f,JSON.stringify(g)),w()}function U(){var t=L(),e=n.getItem(l);null!==e&&t-parseInt(e,10)>18e5&&(N(d,J(h,m=t)),k())}function H(t){return t.map(t=>JSON.stringify(t)).join("\n")}function I(t){return new Date(t).toISOString().replace("T"," ").split(".")[0]}function L(){var t=new Date;return Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds())}function J(t,e){return t+":"+e}function N(e,n){t.document.cookie=e+"="+(n||"")+"; path=/; domain="+s}function E(e){var n=e+"=";if(t.document.cookie)for(var r=t.document.cookie.split(";"),i=0;i<r.length;++i){for(var o=r[i];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(n))return o.substring(n.length,o.length)}return null}function M(t){return e.currentScript.getAttribute("data-"+t)}};return t(window),t}();
//# sourceMappingURL=tinybird-tracker.js.map
