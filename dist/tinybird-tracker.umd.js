!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).tinybirdTrackerJs=t()}(this,function(){var e=window.localStorage;function t(e){return(e=e||new Date).toISOString().replace("T"," ").split(".")[0]}return function n(r,o,i,s){i=i||"tracker_ga";var u=function(e){for(var t=document.cookie.split(";"),n=0;n<t.length;++n){for(var r=t[n];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf("_track="))return r.substring("_track=".length,r.length)}return null}();u||(u="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),document.cookie="_track="+(u||"")+"; path=/");var a=t(),c=JSON.parse(e.getItem("tinybird_events")||"[]"),d=!1;function l(e){d||(c.length>0?(d=!0,function(e,t){return t=t||{},new Promise(function(n,r){var o=new XMLHttpRequest,i=[],s=[],u={},a=function(){return{ok:2==(o.status/100|0),statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(JSON.parse(o.responseText))},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:a,headers:{keys:function(){return i},entries:function(){return s},get:function(e){return u[e.toLowerCase()]},has:function(e){return e.toLowerCase()in u}}}};for(var c in o.open(t.method||"get",e,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,t,n){i.push(t=t.toLowerCase()),s.push([t,n]),u[t]=u[t]?u[t]+","+n:n}),n(a())},o.onerror=r,o.withCredentials="include"==t.credentials,t.headers)o.setRequestHeader(c,t.headers[c]);o.send(t.body||null)})}((s||"https://api.tinybird.co")+"/v0/datasources?mode=append&name=tracker&token="+r,{method:"POST"}).then(function(e){return e.json()}).then(function(t){t&&!t.error?(c=[],window.localStorage.setItem("tinybird_events","[]"),f(2e3,5)):e>0&&(d=!1,f(2e3,e-1)),d=!1}).catch(function(){e>0&&(d=!1,f(2e3,e-1))})):f(2e3,5))}function f(e,t){setTimeout(function(){l(t)},e)}function x(){e.setItem("tinybird_events",JSON.stringify(c)),l()}f(2e3,5),n.flush=l,window[i]=function(){var e=[t(),a,o,u,document.location.href,navigator.userAgent].concat(Array.prototype.slice.call(arguments));e.length<14&&(e=e.concat(Array(14-e.length).fill(""))),c.push(e),"pageload"===arguments[0]&&l()},window.addEventListener("beforeunload",x),window.addEventListener("unload",x,!1)}});
//# sourceMappingURL=tinybird-tracker.umd.js.map
